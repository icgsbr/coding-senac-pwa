var Creditly=function(){function n(e,r){return r=$.trim($(r).val()),r+=String.fromCharCode(e.which),_(r)}function a(e,r,t){return e.preventDefault(),r=r,!(n(e,t).length>r||e.shiftKey||(e=e,!/^\d+$/.test(String.fromCharCode(e.which))))}function i(e){return e.match("^(34|37)")}function s(e,r,t){return n=e,!(-1!==$.inArray(n.which,[46,8,9,0,27,13,190])||65==n.which&&!0===n.ctrlKey||67==n.which&&!0===n.ctrlKey||86==n.which&&!0===n.ctrlKey||35<=n.which&&n.which<=39)&&a(e,r,t);var n}var u,c,o,l,d,p,h,v,g,m,t,f,_=function(e){return e.replace(/[^\d]/g,"")},y={createCvvInput:function(e,r){u=e,c=r;$(u).keypress(function(e){$(u).removeClass("has-error");var r=n(e,c),t=n(e,u),r=i(r);s(e,r?4:3,u)&&$(u).val(t)})}},C=(l=[4,10,15],d=[4,8,12,16],p=function(e,r){for(var t=[],n=0,a=0;a<r.length;a++){if(!(e.length>r[a])){a<r.length?t.push(e.slice(n,r[a])):t.push(e.slice(n));break}t.push(e.slice(n,r[a])),n=r[a]}return 0<t.length?t.join(" "):e},{createNumberInput:function(e){o=e,$(o).keypress(function(e){$(o).removeClass("has-error");var r=n(e,o),t=i(r);s(e,t?15:16,o)&&(t=p(r,t?l:d),$(o).val(t),$(o).trigger("changed_input"))})}}),e=(h=/(\d\d)\s*\/\s*(\d\d)/,v=function(e){return 15==e.length},g=function(e){if(0===e.length)return!1;if(/[^0-9-\s]+/.test(e))return!1;for(var r=0,t=0,n=!1,a=e.length-1;0<=a;a--){var i=e.charAt(a),t=parseInt(i,10);n&&9<(t*=2)&&(t-=9),r+=t,n=!n}return r%10==0},m={creditCard:function(e,r){var t=$(r.creditCardNumberSelector).val(),n=$.trim(t).replace(/\D/g,""),a=$(r.cvvSelector).val(),i=$.trim(a).replace(/\D/g,""),s=[],u=!0,c=[];return g(n)||(s.push(r.message.number),c.push(r.creditCardNumberSelector),u=!1),t=v(n),a=i,t&&4==a.length||!t&&3==a.length||(s.push(r.message.security_code),c.push(r.cvvSelector),u=!1),result={is_valid:u,output_value:[n,i],selectors:c,messages:s},result},creditCardExpiration:function(e,r){var t=$.trim($(e).val()),n=h.exec(t),a=!1,e=["",""];return n&&3===n.length&&(t=parseInt(n[1],10),n="20"+n[2],0<=t&&t<=12&&(a=!0,e=[t,n])),{is_valid:a,messages:[r.message],output_value:e}}},{validate:function(e){var t,n,i,r,a=(t=[],n=[],{addError:function(e,r){r.hasOwnProperty("selectors")?n=n.concat(r.selectors):n.push(e),t.concat(r.messages)},triggerErrorMessage:function(){for(var e={selectors:n,messages:t},r=0;r<n.length;r++)$(n[r]).addClass("has-error");$("body").trigger("creditly_client_validation_error",e)}}),s={addOutput:function(e,r){for(var t=e.split("."),n=i,a=0;a<t.length;a++)n.hasOwnProperty(t[a])||(n[t[a]]={}),a===t.length-1?n[t[a]]=r:n=n[t[a]]},getOutput:function(){return i}},u=!(i={});for(r in e)!function(e,r,t,n){if(r.hasOwnProperty(e)){var a=r[e],r=a.type,i=(a.name,m[r](e,a.data));if(!i.is_valid)return t.addError(e,i),!0;if(a.output_name instanceof Array)for(var s=0;s<a.output_name.length;s++)n.addOutput(a.output_name[s],i.output_value[s]);else n.addOutput(a.output_name,i.output_value)}}(r,e,a,s)||(u=!0);return u?(a.triggerErrorMessage(),!1):s.getOutput()}}),b={createExpirationInput:function(e){t=e,$(t).keypress(function(e){var r;$(t).removeClass("has-error"),s(e,4,t)&&(2<=(r=n(e,t)).length?(e=r.slice(0,2)+" / "+r.slice(2),$(t).val(e)):$(t).val(r))})},parseExpirationInput:function(e){var r=_($(e).val()),e=r.slice(0,2);return{year:"20"+r.slice(2),month:e}}},x={changeCardType:function(t,n){$(t).on("changed_input keypress keydown keyup",function(e){var r=$(t).val(),r=(r=_(r),/^(34|37)/.test(r)?"American Express":/^4/.test(r)?"Visa":/^5[0-5]/.test(r)?"MasterCard":/^(6011|622|64[4-9]|65)/.test(r)?"Discover":"");$(n).text(r)})}},w=function(e,r,t,n){n=n||{};n.security_code_message=n.security_code_message||"Your security code is invalid",n.number_message=n.number_message||"Your credit card number is invalid",n.expiration_message=n.expiration_message||"Your credit card expiration is invalid",(f={})[r]={type:"creditCard",data:{cvvSelector:t,creditCardNumberSelector:r,message:{security_code:n.security_code_message,number:n.number_message}},output_name:["number","security_code"]},f[e]={type:"creditCardExpiration",data:{message:n.expiration_message},output_name:["expiration_month","expiration_year"]}};return{initialize:function(e,r,t,n,a){return w(e,r,t,a),b.createExpirationInput(e),C.createNumberInput(r),y.createCvvInput(t,r),x.changeCardType(r,n),this},validate:function(){return e.validate(f)}}}();